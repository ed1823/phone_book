{% extends "base.html" %}
{% load widget_tweaks %}

{% block title %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è{% endblock %}

{% block content %}
<h2 class="text-2xl font-semibold mb-6">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>

<form method="post" class="max-w-md bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4 border border-gray-200">
  {% csrf_token %}

  {% if form.non_field_errors %}
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 animate-shake">
      <strong>‚ö†Ô∏è –û—à–∏–±–∫–∞:</strong> {{ form.non_field_errors.0 }}
    </div>
  {% endif %}

  <!-- Username -->
  <div class="mb-4">
    <label class="block text-gray-700 text-sm font-bold mb-2">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
    {% render_field form.username class="shadow appearance-none border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" %}
    {% for error in form.username.errors %}
      <p class="text-red-600 text-sm mt-1">‚ùó {{ error }}</p>
    {% endfor %}
  </div>

  <!-- Password1 -->
  <div class="mb-4 relative">
    <label class="block text-gray-700 text-sm font-bold mb-2">–ü–∞—Ä–æ–ª—å</label>
    {% render_field form.password class="password-input shadow border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" %}
    <span onclick="togglePassword(this)" class="absolute right-3 top-10 cursor-pointer text-sm">üëÅÔ∏è</span>

    <ul class="text-sm mt-2 ml-1 space-y-1" id="passwordRules">
      <li class="rule text-gray-600">‚úÖ –ù–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤</li>
      <li class="rule text-gray-600">‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç —Ü–∏—Ñ—Ä—É</li>
      <li class="rule text-gray-600">‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç –±—É–∫–≤—É</li>
    </ul>

    {% for error in form.password.errors %}
      <p class="text-red-600 text-sm mt-1">‚ùó {{ error }}</p>
    {% endfor %}
  </div>

  <!-- Password2 -->
  <div class="mb-6 relative">
    <label class="block text-gray-700 text-sm font-bold mb-2">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
    {% render_field form.password_confirm class="password-confirm shadow border rounded w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" %}
    <span onclick="togglePassword(this)" class="absolute right-3 top-10 cursor-pointer text-sm">üëÅÔ∏è</span>
    {% for error in form.password_confirm.errors %}
      <p class="text-red-600 text-sm mt-1">‚ùó {{ error }}</p>
    {% endfor %}
  </div>

  <!-- Submit -->
  <div class="flex items-center justify-between">
    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
      –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
    </button>
  </div>
</form>

<script>
  function togglePassword(icon) {
    const input = icon.previousElementSibling;
    input.type = input.type === "password" ? "text" : "password";
  }

  const passwordInput = document.querySelector('.password-input');
  const rules = document.querySelectorAll('#passwordRules .rule');

  passwordInput?.addEventListener('input', function () {
    const value = passwordInput.value;
    rules[0].textContent = value.length >= 8 ? '‚úÖ –ù–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤' : '‚ùå –ù–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤';
    rules[1].textContent = /\d/.test(value) ? '‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç —Ü–∏—Ñ—Ä—É' : '‚ùå –°–æ–¥–µ—Ä–∂–∏—Ç —Ü–∏—Ñ—Ä—É';
    rules[2].textContent = /[A-Za-z–ê-–Ø–∞-—è–Å—ë]/.test(value) ? '‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç –±—É–∫–≤—É' : '‚ùå –°–æ–¥–µ—Ä–∂–∏—Ç –±—É–∫–≤—É';

    rules.forEach(r => {
      r.classList.remove('text-green-600', 'text-red-600');
      if (r.textContent.startsWith('‚úÖ')) r.classList.add('text-green-600');
      else r.classList.add('text-red-600');
    });
  });
</script>
{% endblock %}
